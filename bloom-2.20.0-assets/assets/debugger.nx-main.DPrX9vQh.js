import{rg as G,al as Q,R as e,an as g,mb as B,rh as J,N as d,ag as A,ri as L,rj as W,rk as $,rl as V,dN as _,rm as H,aB as b,rn as K,ro as X,rp as Y,rq as Z,rr as ee,rs as se,d$ as te,rt as ae,ru as ne,aa as R,rv as ie,rw as re,rx as le,az as S,Z as oe,dV as ce,ry as de,rz as ue,rA as ge,rB as he,rC as k,rD as xe,rE as D,cg as T,ch as P,rF as me,rG as fe,ar as E,rH as je,ai as M,ah as q,rI as pe,rJ as ve,rK as Ne,hY as I,rL as y}from"./index-B7B3_d_S.js";import{R as be}from"./Radio.BHXOF-Ic.js";var O=(s=>(s.STARTED="started",s.STOPPED="stopped",s))(O||{}),w=(s=>(s.ONLINE="online",s.OFFLINE="offline",s.UNKNOWN="unknown",s))(w||{});const ye=()=>{const s=G(),[a]=Q.useLogoutMutation();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{children:"Session"}),e.jsxs("div",{children:["User ID: ",s??"unavailable"]}),e.jsx(g,{onClick:()=>{s===null?B():(a(),J())},children:s===null?"Login":"Logout"})]})})})},Ce=()=>{const[s,a]=d.useState(!1),n=A();return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 ",children:[e.jsx("p",{children:`Connection hook triggered: ${s.toString()}`}),e.jsx(g,{onClick:()=>{n.open({modalTabId:"Remote"},()=>{a(!0)})},children:"Open Connection Modal"})]})},ke=()=>{const s=L(W),a=L($),[n,o]=d.useState(s??""),[i,t]=V();d.useEffect(()=>{i(void 0)},[]);const h=d.useMemo(()=>{if(t.error!==void 0){if("message"in t.error&&typeof t.error.message=="string")return t.error.message;if("error"in t.error)return t.error.error}return"Unknown error"},[t.error]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{children:"Available playlists"}),t.isError?e.jsx(_,{type:"danger",title:"Manifest error",description:h,usage:"inline"}):null,Object.keys(t.data?.playlists??{}).map(r=>e.jsx(be,{isDisabled:t.isFetching||t.isError,isChecked:r===a,value:r,onChange:()=>H(r),label:r,htmlAttributes:{name:"current_playlist"}},r)),e.jsx(g,{isLoading:t.isFetching,onClick:()=>{i(void 0)},children:"Refetch manifest"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{children:"Manifest origin override"}),e.jsx(b,{isFluid:!0,helpText:s===void 0?"No override is set":`Override URL is set to ${s}`,size:"medium",value:n,onChange:r=>{o(r.target.value)},label:"URL",htmlAttributes:{placeholder:"Example: http://localhost:4000/"}}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(g,{onClick:()=>{K(n),i(void 0)},children:"Update URL"}),e.jsx(g,{color:"danger",onClick:()=>{o(""),X(),i(void 0)},children:"Reset URL"})]})]})]})};function x(s){return e.jsxs("div",{className:"bg-palette-neutral-bg-weak shadow-raised space-y-1 rounded-lg p-4",children:[e.jsx("h3",{className:"h3 pb-2",children:s.title}),s.children]})}const U=()=>`Neo4j ${(Math.random()+1).toString(36).substring(7)}`,Le=()=>{const s={value:"5.16.0",label:"5.16.0"},[a,n]=d.useState(U()),[o,i]=d.useState(""),[t,h]=d.useState(""),[r,m]=d.useState(!1),[c,f]=d.useState(s),{data:v}=Y(),[j]=Z(),p=()=>{n(U()),i(""),f(s),m(!1)},l=()=>{if(o.length<8){h("Password must be at least 8 characters long");return}m(!0),h(""),j({name:a,version:c.value,credentials:o}).finally(()=>{p()})},N=(v??[]).filter(u=>ee(u.version,"5.0.0")>=0).map(u=>({label:u.version,value:u.version})).sort((u,z)=>se(u.value,z.value));return e.jsx(x,{title:"Create local instance",children:e.jsxs("form",{children:[e.jsx("div",{className:"mt-2",children:e.jsx(b,{isDisabled:r,isFluid:!0,value:a,onChange:u=>n(u.target.value),label:"Name",htmlAttributes:{type:"text",autoFocus:!0}})}),e.jsx("div",{className:"mt-2",children:e.jsx(b,{isDisabled:r,isFluid:!0,errorText:t,value:o,onChange:u=>i(u.target.value),label:"Password",htmlAttributes:{type:"password",required:!0}})}),e.jsx("div",{className:"mt-2",children:e.jsx(te,{size:"small",type:"select",selectProps:{isDisabled:r,options:N,value:c,onChange:u=>f(u??c)},label:"Neo4j version"})}),e.jsx("div",{className:"flex flex-row justify-end pt-2",children:e.jsx(g,{type:"submit",onClick:l,isLoading:r,children:r?"Creating":"Create"})})]})})},Se=({isStarted:s,isOnline:a,id:n,connectionUri:o,disabled:i})=>{const[t]=ae({fixedCacheKey:`dbms-start-${n}`}),[h]=ne(),[r,m]=d.useState(!1),[c,f]=d.useState(!1),v=R(),j=A(),{isConnected:p,isDisconnected:l}=v.status;d.useEffect(()=>{m(!1)},[s]),d.useEffect(()=>{c&&a&&l&&(j.open({modalTabId:"Remote"}),f(!1))},[c,a,p]),d.useEffect(()=>{c&&!a&&p&&(v.disconnect(),f(!1))},[c,a,l]);const N=s?h:t;let u=s?"Stop":"Start";return r&&(u=u==="Stop"?"Stopping":"Starting"),e.jsxs(e.Fragment,{children:[!r&&a&&l&&e.jsx(g,{isDisabled:i,className:"mr-2",onClick:()=>{j.open({modalTabId:"Remote"})},children:"Connect"}),e.jsx(g,{isDisabled:i,isLoading:r,fill:s?"filled":"outlined",onClick:()=>{m(!0),N(n),f(!0)},children:u})]})},we=()=>{const{data:s,isLoading:a}=ie(),{data:n}=re(),[o,i]=le();return e.jsx(x,{title:"Local instances",children:e.jsxs("div",{className:"flex w-full flex-col items-center",children:[a&&e.jsx(S,{size:"large"}),!a&&s&&s.length>0?e.jsx("ul",{className:"w-full",children:s.map(t=>{if(n){const h=n.entities[t.id],r=h?.status===O.STARTED,m=h?.serverStatus===w.UNKNOWN;return e.jsxs("li",{className:"mt-2 flex flex-row items-center",children:[m&&e.jsx(S,{size:"small"})," ",t.name,"- ",h?.version,e.jsxs("div",{className:"ml-auto flex flex-row",children:[e.jsx(Se,{isStarted:r,isOnline:h?.serverStatus===w.ONLINE,id:t.id,connectionUri:t.connectionUri,disabled:m||i.originalArgs===t.id&&i.isLoading}),e.jsx(oe,{ariaLabel:"Uninstall",className:"ml-2",isDanger:!0,isDisabled:m||r||i.originalArgs!==t.id&&i.isLoading,isLoading:i.originalArgs===t.id&&i.isLoading,onClick:()=>{o(t.id).then(async()=>{await globalThis.neo4jWorkspaceDesktop.credentialsManager.delete(t.id)})},children:e.jsx(ce,{})})]})]},`instance-${t.id}`)}return null})}):null]})})},Te=()=>{const{isSuccess:s,data:a}=de();return s?e.jsxs(e.Fragment,{children:[e.jsx(ue,{code:JSON.stringify(a),language:"json"}),e.jsx(Le,{}),e.jsx(we,{})]}):null},Ie=()=>{const{openGuide:s,setGuideCurrentPage:a}=ge(),{isLoading:n,isError:o,data:i}=he(),[t,h]=d.useState("https://neo4j.github.io/workspace-guides/guides-writing-guidance.workspace.json");if(n)return e.jsx(S,{});const r=i?.guides;if(o||!r)return e.jsx("p",{children:"Error: Can't load guides manifest"});const m={id:k.NX_INTERNAL_TEST,title:"Custom guide preview",url:t};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("h4",{children:"Available guides"}),e.jsx("ul",{className:"mb-2 grid grid-cols-2 gap-4",children:Object.keys(r).map(c=>e.jsx("li",{children:e.jsx(g,{className:"w-full",fill:"outlined",onClick:()=>{s({id:c,title:c.replace("-"," "),url:r[c]?.url??"",target:"sidebar"})},children:c})},c))}),e.jsx("h4",{children:"Preview guide"}),e.jsxs("div",{children:[e.jsx(b,{isFluid:!0,size:"medium",value:t,onChange:c=>h(c.target.value),label:"URL"}),e.jsx(g,{className:"mt-4",onClick:()=>{s({id:k.NX_INTERNAL_TEST,url:m.url,title:m.title,target:"sidebar"}),a({id:k.NX_INTERNAL_TEST,pageNumber:0})},children:"Preview"})]})]})},Ee=()=>{const{addNotification:s,notifications:a}=xe();return e.jsxs("div",{"data-testid":"notifications-section",className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("pre",{className:"h-[240px] w-full overflow-scroll text-xs",children:JSON.stringify(a,null,2)}),e.jsxs("div",{children:[["info","success","warning","danger","neutral"].map(n=>e.jsx(g,{className:"mr-2 mt-2",onClick:()=>{s({type:n,title:`${n} notification`,description:"This is a test notification",actionCallbacks:["reload"]})},children:n},n)),e.jsx(g,{className:"mr-2 mt-2",onClick:()=>{s({type:"info",title:"Timeout notification",description:"This is a test notification",timeout:2e3})},children:"timeout"},"timeout")]})]})};function C({query:s,children:a}){const[n,o]=d.useState(!0),[i,t]=D({query:s},{metadata:{appScope:T.debugger,queryType:P.UserAction},paused:n});return e.jsxs("div",{className:"flex p-2",children:[e.jsxs("div",{className:"mr-10 flex w-56 flex-shrink-0 flex-col",children:[e.jsx(g,{isLoading:i.fetching,size:"small",onClick:()=>{o(!1)},children:a}),i.fetching&&e.jsx(g,{size:"small",onClick:()=>{o(!0)},children:"Cancel"}),!n&&!i.fetching?e.jsx(g,{size:"small",onClick:()=>{t()},children:"Re-run"}):null]}),e.jsxs("div",{className:"max-h-32 overflow-auto",children:[e.jsx("pre",{className:"query-result whitespace-pre-wrap",children:JSON.stringify(i.records,null,2)}),i.error?e.jsx("span",{className:"query-error",children:i.error.message}):null]})]})}function Ue(){return e.jsxs("div",{className:"grid items-start",style:{gridTemplateColumns:"repeat(auto-fit, minmax(calc(100% / 2), 1fr))"},children:[e.jsx(C,{query:"WITH range(1,500) as range UNWIND range as item RETURN item",children:"async query"}),e.jsx(C,{query:"CALL apoc.util.sleep(30000)",children:"async query long"}),e.jsx(C,{query:"WITH range(1,500) as range UNWIND range as item RETURN item",children:"rx query"}),e.jsx(C,{query:"CALL apoc.util.sleep(30000)",children:"rx query long"})]})}const F=!1,Fe="example:hello-world";function Ae(s){const[a,n]=M(s.name);return e.jsx(I,{onChange:()=>n(),label:s.name,isChecked:a})}function Re(s){const[a,n]=q(s.flag);return e.jsx(I,{onChange:()=>n(),isChecked:a,label:s.flag})}const De={appScope:T.debugger,queryType:P.System};function qe(){const s=me(),a=fe(),n=R(),[o]=D({query:"CALL apoc.util.sleep(1) RETURN 1"},{metadata:De,transactionMode:"read"}),[i,t]=E("global","usageTracking"),[h,r]=E("global","theme");je(T.debugger).debug("isDev",F);const c=o.error!==void 0&&o.records!==void 0&&o.records.length>0,[f]=M("framework:relate-api"),[v]=q(Fe,F),j=L(pe),p=d.useMemo(()=>{const l=new URL("/",window.location.origin);for(const N of j)l.searchParams.append("enableFlag",N);return l.toString()},[j]);return e.jsxs("main",{className:"mb-60 p-4","data-testid":"debugger-app",children:[e.jsx("h2",{className:"pb-4",children:"Debug"}),e.jsxs("h3",{className:"pb-4",children:["Version: ","2.20.0"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(x,{title:"Feature Flags",children:[v&&e.jsx("div",{children:"I'm only shown in development!"}),"Available flags (click to load feature flag):",e.jsx("div",{className:"space-y-2 p-2 text-left",children:ve.map(l=>e.jsx(Re,{flag:l},l))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"flex-grow",isFluid:!0,htmlAttributes:{onClick:l=>l.currentTarget.select(),"aria-label":"Feature flag URL",defaultValue:p}}),e.jsx(g,{onClick:()=>{navigator.clipboard.writeText(p)},children:"Copy"})]})]}),f&&e.jsx(x,{title:"Desktop",children:e.jsx(Te,{})}),e.jsx(x,{title:"Capabilities",children:e.jsx("div",{className:"space-y-2 p-2 text-left",children:Ne.map(l=>e.jsx(Ae,{name:l},l))})}),e.jsxs(x,{title:"Configuration",children:[e.jsx("h4",{children:"Internal configuration"}),e.jsx("code",{children:e.jsx("pre",{children:JSON.stringify(s,null,2)})}),e.jsx("h4",{children:"Tool configurations"}),e.jsx("code",{children:e.jsx("pre",{children:JSON.stringify(a,null,2)})})]}),e.jsx(x,{title:"Guides",children:e.jsx(Ie,{})}),e.jsx(x,{title:"Playlist Preview",children:e.jsx(ke,{})}),e.jsx(x,{title:"Authentication",children:e.jsx(ye,{})}),e.jsxs(x,{title:"Context",children:[e.jsxs("div",{children:["Bolt URL: ",n.metadata?.url]}),e.jsxs("div",{children:["Has APOC: ",e.jsx("span",{"data-testid":"has-apoc",children:c.toString()})]})]}),e.jsx(x,{title:"Settings",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{value:"allowed",onChange:()=>t(l=>!l),isChecked:i,label:"Allow usage tracking",htmlAttributes:{name:"usageTracking",checked:i}}),e.jsx("h4",{children:"Theme"}),e.jsxs(y,{onChange:l=>r(l),selected:h,children:[e.jsx(y.Item,{value:"light",children:"Light"}),e.jsx(y.Item,{value:"dark",children:"Dark"}),e.jsx(y.Item,{value:"system",children:"System"})]})]})}),e.jsx(x,{title:"Queries",children:e.jsx(Ue,{})}),e.jsx(x,{title:"Connection Callback",children:e.jsx(Ce,{})}),e.jsx(x,{title:"Notifications",children:e.jsx(Ee,{})}),e.jsx("div",{className:"border-palette-primary-border-weak hidden border-2 sm:block",children:"I'm hidden on small screens"})]})]})}export{qe as default};
